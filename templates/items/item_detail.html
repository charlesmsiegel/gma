{% extends "base.html" %}
{% load static %}
{% block title %}{{ page_title }}{% endblock %}
{% block extra_css %}
  <style>
.detail-card {
    border: none;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}
.detail-label {
    font-weight: 600;
    color: #6c757d;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.5px;
}
.detail-value {
    font-size: 1rem;
    color: #212529;
}
.audit-info {
    background-color: #f8f9fa;
    border-left: 4px solid #6c757d;
}
  </style>
{% endblock %}
{% block content %}
  <div class="container">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="{% url 'campaigns:detail' slug=campaign.slug %}">{{ campaign.name }}</a>
        </li>
        <li class="breadcrumb-item">
          <a href="{% url 'items:campaign_items' slug=campaign.slug %}">Items</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">{{ item.name }}</li>
      </ol>
    </nav>
    <div class="row">
      <!-- Main Content -->
      <div class="col-lg-8">
        <div class="card detail-card mb-4">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div>
              <h1 class="h3 mb-1">{{ item.name }}</h1>
              {% if item.quantity > 1 %}
                <span class="badge bg-primary fs-6">Quantity: {{ item.quantity }}</span>
              {% endif %}
            </div>
            {% if can_edit or can_delete %}
              <div class="btn-group" role="group" aria-label="Item actions">
                {% if can_edit %}
                  <a href="{% url 'items:edit' slug=campaign.slug item_id=item.id %}"
                     class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-pencil"></i> Edit
                  </a>
                {% endif %}
                {% if can_delete %}
                  <a href="{% url 'items:delete' slug=campaign.slug item_id=item.id %}"
                     class="btn btn-outline-danger btn-sm">
                    <i class="bi bi-trash"></i> Delete
                  </a>
                {% endif %}
              </div>
            {% endif %}
          </div>
          <div class="card-body">
            <!-- Description -->
            {% if item.description %}
              <div class="mb-4">
                <div class="detail-label mb-1">Description</div>
                <div class="detail-value">{{ item.description|linebreaks }}</div>
              </div>
            {% else %}
              <div class="mb-4">
                <div class="detail-label mb-1">Description</div>
                <div class="detail-value text-muted">No description provided</div>
              </div>
            {% endif %}
            <!-- Basic Details -->
            <div class="row mb-4">
              <div class="col-sm-6">
                <div class="detail-label mb-1">Quantity</div>
                <div class="detail-value">{{ item.quantity }}</div>
              </div>
              <div class="col-sm-6">
                <div class="detail-label mb-1">Campaign</div>
                <div class="detail-value">
                  <a href="{% url 'campaigns:detail' slug=campaign.slug %}"
                     class="text-decoration-none">{{ campaign.name }}</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Sidebar -->
      <div class="col-lg-4">
        <!-- Ownership Information -->
        <div class="card detail-card mb-4">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="bi bi-person-circle"></i> Ownership
            </h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <div class="detail-label mb-1">Current Owner</div>
              <div class="detail-value">
                {% if item.owner %}
                  <span class="text-primary">
                    <i class="bi bi-person-fill"></i> {{ item.owner.name }}
                  </span>
                  <div class="small text-muted mt-1">
                    {% if item.owner.player_owner %}
                      Played by: {{ item.owner.player_owner.username }}
                    {% else %}
                      NPC
                    {% endif %}
                  </div>
                {% else %}
                  <span class="text-muted">
                    <i class="bi bi-question-circle"></i> Unowned
                  </span>
                {% endif %}
              </div>
            </div>
            {% if item.last_transferred_at %}
              <div class="mb-3">
                <div class="detail-label mb-1">Last Transferred</div>
                <div class="detail-value small">
                  {{ item.last_transferred_at|date:"M j, Y" }} at {{ item.last_transferred_at|time:"g:i A" }}
                </div>
              </div>
            {% endif %}
          </div>
        </div>
        <!-- Audit Information -->
        <div class="card detail-card audit-info">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="bi bi-clock-history"></i> Audit Trail
            </h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <div class="detail-label mb-1">Created</div>
              <div class="detail-value small">
                {{ item.created_at|date:"M j, Y" }} at {{ item.created_at|time:"g:i A" }}
                {% if item.created_by %}
                  <br>
                  by {{ item.created_by.username }}
                {% endif %}
              </div>
            </div>
            {% if item.updated_at and item.updated_at != item.created_at %}
              <div class="mb-3">
                <div class="detail-label mb-1">Last Updated</div>
                <div class="detail-value small">
                  {{ item.updated_at|date:"M j, Y" }} at {{ item.updated_at|time:"g:i A" }}
                  {% if item.modified_by %}
                    <br>
                    by {{ item.modified_by.username }}
                  {% endif %}
                </div>
              </div>
            {% endif %}
            {% if item.is_deleted %}
              <div class="mb-3">
                <div class="detail-label mb-1">Deleted</div>
                <div class="detail-value small text-danger">
                  {{ item.deleted_at|date:"M j, Y" }} at {{ item.deleted_at|time:"g:i A" }}
                  {% if item.deleted_by %}
                    <br>
                    by {{ item.deleted_by.username }}
                  {% endif %}
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <!-- Action Buttons -->
    <div class="d-flex justify-content-between align-items-center mt-4">
      <div>
        <a href="{% url 'items:campaign_items' slug=campaign.slug %}"
           class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left"></i> Back to Items
        </a>
      </div>
      {% if can_edit or can_delete %}
        <div class="btn-group" role="group" aria-label="Item actions">
          {% if can_edit %}
            <a href="{% url 'items:edit' slug=campaign.slug item_id=item.id %}"
               class="btn btn-primary">
              <i class="bi bi-pencil"></i> Edit Item
            </a>
          {% endif %}
          {% if can_delete %}
            <a href="{% url 'items:delete' slug=campaign.slug item_id=item.id %}"
               class="btn btn-outline-danger">
              <i class="bi bi-trash"></i> Delete Item
            </a>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}
